===================================================================================
ğŸ“‹ PROMPT CHI TIáº¾T - IMPLEMENT CONTENT/PRODUCT AUTHORSHIP & MODERATOR PERMISSIONS
===================================================================================

ğŸ¯ Má»¤C TIÃŠU Tá»”NG QUAN:
----------------------
Cáº£i tiáº¿n há»‡ thá»‘ng quáº£n lÃ½ content/product vá»›i cÃ¡c yÃªu cáº§u sau:
1. Author máº·c Ä‘á»‹nh lÃ  ngÆ°á»i táº¡o (auto-fill cho moderator, cÃ³ thá»ƒ edit cho admin)
2. Moderator chá»‰ Ä‘Æ°á»£c CRUD content/product cá»§a chÃ­nh há»
3. Admin cÃ³ quyá»n gÃ¡n author cho báº¥t ká»³ ai + CRUD táº¥t cáº£ content
4. ThÃªm status "pending" cho moderator (cáº§n admin approve)
5. Hiá»ƒn thá»‹ thÃ´ng tin "Created by" vÃ  "Last updated by" (cáº£ backend & frontend)
6. **ThÃªm Admin Sidebar Menu "Approval Management" Ä‘á»ƒ admin review vÃ  approve content pending**
7. **Moderator Status Workflow: EDIT action vs STATUS-ONLY action (detailed rules below)**

===================================================================================
ğŸ“Š PHÃ‚N TÃCH Há»† THá»NG HIá»†N Táº I:
===================================================================================

BACKEND MODELS:
---------------
âœ… Article: ÄÃ£ cÃ³ author_id relationship vá»›i User
âœ… Video: ÄÃ£ cÃ³ author_id relationship vá»›i User  
âŒ Product: CHÆ¯A CÃ“ author_id (chá»‰ cÃ³ field 'author' string cho book)

MIGRATIONS:
-----------
âœ… Articles table: author_id (foreignId, nullable, onDelete: set null)
âœ… Videos table: author_id (foreignId, nullable, onDelete: set null)
âš ï¸ Products table: ÄÃƒ CÃ“ author_id (@2025_10_17_000001) - NHÆ¯NG CHÆ¯A CÃ“ created_by, updated_by

STATUS FIELDS:
--------------
âœ… Article: enum('draft', 'published') - Cáº¦N THÃŠM 'pending', 'archived'
âœ… Video: enum('draft', 'published') - Cáº¦N THÃŠM 'pending', 'archived'
âœ… Product: enum('draft', 'published', 'archived') - Cáº¦N THÃŠM 'pending'

CONTROLLERS HIá»†N Táº I:
---------------------
- ProductController: store() vÃ  update() KHÃ”NG set author_id
- ArticleController: store() vÃ  update() CÃ“ validate author_id nhÆ°ng khÃ´ng auto-set
- VideoController: store() vÃ  update() CÃ“ validate author_id nhÆ°ng khÃ´ng auto-set
- Táº¥t cáº£ controllers: KhÃ´ng kiá»ƒm tra ownership cho moderator

AUTHENTICATION & AUTHORIZATION:
--------------------------------
- Route middleware: 'check.role:admin,moderator' (cho phÃ©p cáº£ 2)
- Controllers: Check isAdmin = admin || moderator
- CHÆ¯A CÃ“ logic phÃ¢n biá»‡t quyá»n giá»¯a admin vs moderator

TIMESTAMPS vs AUDIT TRACKING:
------------------------------
âš ï¸ QUAN TRá»ŒNG - PhÃ¢n biá»‡t 2 loáº¡i tracking:

âœ… Laravel Timestamps (ÄÃƒ CÃ“ Sáº´N):
- created_at: DateTime - Thá»i gian táº¡o record
- updated_at: DateTime - Thá»i gian cáº­p nháº­t cuá»‘i

âŒ Audit Tracking (Cáº¦N THÃŠM):
- created_by: Foreign Key â†’ users.id - User nÃ o táº¡o record
- updated_by: Foreign Key â†’ users.id - User nÃ o sá»­a láº§n cuá»‘i

Má»¤C ÄÃCH: Hiá»ƒn thá»‹ "Created by John Doe on 2025-10-17" vÃ  "Last updated by Admin on 2025-10-18"

MODERATOR STATUS WORKFLOW (QUAN TRá»ŒNG):
----------------------------------------
âš ï¸ Moderator cÃ³ 2 LOáº I ACTIONS khÃ¡c nhau:

1ï¸âƒ£ EDIT ACTION (vÃ o form, sá»­a ná»™i dung):
   - Click "Edit" button â†’ VÃ o form
   - Sá»­a báº¥t ká»³ field nÃ o (title, description, image, etc.)
   - Click "Save Changes"
   - â†’ Status AUTO = Pending (báº¯t buá»™c)
   - â†’ KHÃ”NG cÃ³ dropdown status trong form
   - â†’ Content cáº§n admin approve láº¡i

2ï¸âƒ£ STATUS-ONLY ACTION (quick buttons ngoÃ i list):
   - KHÃ”NG vÃ o form edit
   - Chá»‰ Ä‘á»•i status, KHÃ”NG sá»­a content
   - Allowed transitions:
     * Published â†’ Archived (take down button)
     * Archived â†’ Draft (restore button)
     * Draft â†’ Pending (submit button)
     * Pending â†’ Draft (withdraw button)

UI IMPLEMENTATION:
- Content List cÃ³ 2 nhÃ³m buttons:
  * [Edit] = vÃ o form (rule 1ï¸âƒ£)
  * [Archive/Restore/Submit] = quick actions (rule 2ï¸âƒ£)

===================================================================================
ğŸ“ TODO CHI TIáº¾T (PHáº¢I THá»°C HIá»†N TUáº¦N Tá»°):
===================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: DATABASE MIGRATIONS                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 1.1: Update migration hiá»‡n cÃ³ cho Products (thÃªm created_by/updated_by)
-----------------------------------------------------------------------------
âš ï¸ NOTE: Migration @2025_10_17_000001_add_author_id_to_products_table.php ÄÃƒ Tá»’N Táº I
      vÃ  Ä‘Ã£ cÃ³ author_id. Chá»‰ cáº§n UPDATE Ä‘á»ƒ thÃªm created_by vÃ  updated_by.

File: backend/database/migrations/2025_10_17_000001_add_author_id_to_products_table.php

UPDATE ná»™i dung:
```php
public function up(): void
{
    Schema::table('products', function (Blueprint $table) {
        // author_id already exists from previous version - check and add if needed
        if (!Schema::hasColumn('products', 'author_id')) {
            $table->unsignedBigInteger('author_id')->nullable()->after('slug');
            $table->foreign('author_id')->references('id')->on('users')->onDelete('set null');
            $table->index('author_id');
        }
        
        // Add created_by and updated_by for audit trail (NEW)
        if (!Schema::hasColumn('products', 'created_by')) {
            $table->foreignId('created_by')
                  ->nullable()
                  ->after('author_id')
                  ->constrained('users')
                  ->onDelete('set null');
            $table->index('created_by');
        }
        
        if (!Schema::hasColumn('products', 'updated_by')) {
            $table->foreignId('updated_by')
                  ->nullable()
                  ->after('created_by')
                  ->constrained('users')
                  ->onDelete('set null');
            $table->index('updated_by');
        }
    });
}

public function down(): void
{
    Schema::table('products', function (Blueprint $table) {
        if (Schema::hasColumn('products', 'author_id')) {
            $table->dropForeign(['author_id']);
            $table->dropIndex(['author_id']);
            $table->dropColumn('author_id');
        }
        if (Schema::hasColumn('products', 'created_by')) {
            $table->dropForeign(['created_by']);
            $table->dropIndex(['created_by']);
            $table->dropColumn('created_by');
        }
        if (Schema::hasColumn('products', 'updated_by')) {
            $table->dropForeign(['updated_by']);
            $table->dropIndex(['updated_by']);
            $table->dropColumn('updated_by');
        }
    });
}
```

TODO 1.2: Táº¡o migration thÃªm created_by/updated_by cho Articles
----------------------------------------------------------------
File: backend/database/migrations/YYYY_MM_DD_HHMMSS_add_audit_tracking_to_articles_table.php

```php
public function up(): void
{
    Schema::table('articles', function (Blueprint $table) {
        $table->foreignId('created_by')
              ->nullable()
              ->after('author_id')
              ->constrained('users')
              ->onDelete('set null');
        
        $table->foreignId('updated_by')
              ->nullable()
              ->after('created_by')
              ->constrained('users')
              ->onDelete('set null');
        
        $table->index('created_by');
        $table->index('updated_by');
    });
}

public function down(): void
{
    Schema::table('articles', function (Blueprint $table) {
        $table->dropForeign(['created_by']);
        $table->dropForeign(['updated_by']);
        $table->dropColumn(['created_by', 'updated_by']);
    });
}
```

TODO 1.3: Táº¡o migration thÃªm created_by/updated_by cho Videos
--------------------------------------------------------------
File: backend/database/migrations/YYYY_MM_DD_HHMMSS_add_audit_tracking_to_videos_table.php

```php
// TÆ°Æ¡ng tá»± Articles
```

TODO 1.4: Táº¡o migration thÃªm status 'pending' cho táº¥t cáº£ tables
----------------------------------------------------------------
File: backend/database/migrations/YYYY_MM_DD_HHMMSS_add_pending_status_to_content_tables.php

```php
public function up(): void
{
    // Modify Products status enum
    DB::statement("ALTER TABLE products MODIFY status ENUM('draft', 'pending', 'published', 'archived') DEFAULT 'pending'");
    
    // Modify Articles status enum
    DB::statement("ALTER TABLE articles MODIFY status ENUM('draft', 'pending', 'published', 'archived') DEFAULT 'pending'");
    
    // Modify Videos status enum
    DB::statement("ALTER TABLE videos MODIFY status ENUM('draft', 'pending', 'published', 'archived') DEFAULT 'pending'");
}

public function down(): void
{
    // Revert to old enum values
    DB::statement("ALTER TABLE products MODIFY status ENUM('draft', 'published', 'archived') DEFAULT 'published'");
    DB::statement("ALTER TABLE articles MODIFY status ENUM('draft', 'published') DEFAULT 'published'");
    DB::statement("ALTER TABLE videos MODIFY status ENUM('draft', 'published') DEFAULT 'published'");
}
```

âš ï¸ CRITICAL CHECK PHASE 1:
- Verify migrations cÃ³ syntax Ä‘Ãºng
- Verify onDelete('set null') Ä‘á»ƒ trÃ¡nh cascade delete content khi user bá»‹ xÃ³a
- Verify indexes Ä‘Æ°á»£c táº¡o Ä‘Ãºng cho performance
- TEST migration: php artisan migrate (trÃªn server)
- TEST rollback: php artisan migrate:rollback (trÃªn server)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: BACKEND MODELS                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 2.1: Cáº­p nháº­t Product Model
---------------------------------
File: backend/app/Models/Product.php

Changes:
1. ThÃªm vÃ o $fillable:
   - 'author_id'
   - 'created_by'
   - 'updated_by'

2. ThÃªm relationships:
```php
public function author(): BelongsTo
{
    return $this->belongsTo(User::class, 'author_id');
}

public function creator(): BelongsTo
{
    return $this->belongsTo(User::class, 'created_by');
}

public function updater(): BelongsTo
{
    return $this->belongsTo(User::class, 'updated_by');
}
```

3. ThÃªm boot method Ä‘á»ƒ auto-track created_by/updated_by:
```php
protected static function boot()
{
    parent::boot();
    
    static::creating(function ($model) {
        if (auth()->check()) {
            $model->created_by = auth()->id();
            $model->updated_by = auth()->id();
            
            // Auto-set author_id if not provided
            if (!$model->author_id) {
                $model->author_id = auth()->id();
            }
        }
    });
    
    static::updating(function ($model) {
        if (auth()->check()) {
            $model->updated_by = auth()->id();
        }
    });
}
```

4. Cáº­p nháº­t validation cho status:
```php
// Thay 'published', 'archived' thÃ nh:
// 'draft', 'pending', 'published', 'archived'
```

TODO 2.2: Cáº­p nháº­t Article Model
---------------------------------
File: backend/app/Models/Article.php

Changes:
1. ThÃªm 'created_by', 'updated_by' vÃ o $fillable
2. ThÃªm relationships cho creator() vÃ  updater()
3. ThÃªm boot method tÆ°Æ¡ng tá»± Product

TODO 2.3: Cáº­p nháº­t Video Model
-------------------------------
File: backend/app/Models/Video.php

Changes: TÆ°Æ¡ng tá»± Article

âš ï¸ CRITICAL CHECK PHASE 2:
- Verify relationships Ä‘Ãºng: BelongsTo, tÃªn foreign key chÃ­nh xÃ¡c
- Verify boot() method KHÃ”NG conflict vá»›i existing logic
- Verify fillable array cÃ³ Ä‘á»§ fields
- TEST: Táº¡o product/article/video má»›i â†’ check DB xem created_by/updated_by cÃ³ Ä‘Æ°á»£c set
- TEST: Update â†’ check updated_by cÃ³ thay Ä‘á»•i

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3: BACKEND RESOURCES                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 3.1: Cáº­p nháº­t ProductResource
-----------------------------------
File: backend/app/Http/Resources/ProductResource.php

ThÃªm vÃ o toArray():
```php
'author_id' => $this->author_id,
'created_by' => $this->created_by,
'updated_by' => $this->updated_by,

// Relationships (load conditionally)
'author' => $this->whenLoaded('author', function () {
    return [
        'id' => $this->author->id,
        'name' => $this->author->name,
        'email' => $this->author->email,
        'avatar' => $this->author->avatar,
    ];
}),
'creator' => $this->whenLoaded('creator', function () {
    return [
        'id' => $this->creator->id,
        'name' => $this->creator->name,
    ];
}),
'updater' => $this->whenLoaded('updater', function () {
    return [
        'id' => $this->updater->id,
        'name' => $this->updater->name,
    ];
}),
```

TODO 3.2: Cáº­p nháº­t ArticleResource
-----------------------------------
File: backend/app/Http/Resources/ArticleResource.php

ThÃªm tÆ°Æ¡ng tá»± ProductResource (Ä‘Ã£ cÃ³ author, cáº§n thÃªm creator/updater)

TODO 3.3: Cáº­p nháº­t VideoResource
---------------------------------
File: backend/app/Http/Resources/VideoResource.php

ThÃªm tÆ°Æ¡ng tá»±

âš ï¸ CRITICAL CHECK PHASE 3:
- Verify whenLoaded() Ä‘á»ƒ trÃ¡nh N+1 query
- Verify khÃ´ng return sensitive data (password, etc)
- TEST API response cÃ³ chá»©a author/creator/updater info

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 4: BACKEND CONTROLLERS - AUTHORIZATION LOGIC                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 4.1: Táº¡o Helper Trait cho Authorization
---------------------------------------------
File: backend/app/Http/Controllers/Traits/AuthorizesContent.php

```php
<?php

namespace App\Http\Controllers\Traits;

trait AuthorizesContent
{
    /**
     * Check if user can modify content (admin can modify all, moderator only own)
     */
    protected function canModifyContent($content): bool
    {
        $user = auth()->user();
        
        // Admin can modify anything
        if ($user->role === 'admin') {
            return true;
        }
        
        // Moderator can only modify their own content
        if ($user->role === 'moderator') {
            return $content->author_id === $user->id;
        }
        
        return false;
    }
    
    /**
     * Get default status based on user role
     */
    protected function getDefaultStatus(): string
    {
        $user = auth()->user();
        
        // Admin content is published by default
        if ($user->role === 'admin') {
            return 'published';
        }
        
        // Moderator content needs approval
        if ($user->role === 'moderator') {
            return 'pending';
        }
        
        return 'draft';
    }
    
    /**
     * Check if user can set specific status
     */
    protected function canSetStatus(string $status): bool
    {
        $user = auth()->user();
        
        // Admin can set any status
        if ($user->role === 'admin') {
            return true;
        }
        
        // Moderator can only set draft or pending
        if ($user->role === 'moderator') {
            return in_array($status, ['draft', 'pending']);
        }
        
        return false;
    }
    
    /**
     * Check if user can transition from current status to new status
     * 
     * IMPORTANT WORKFLOW RULES:
     * 
     * MODERATOR cÃ³ 2 loáº¡i actions:
     * 1. EDIT (vÃ o form, sá»­a content) â†’ Báº¥t ká»³ thay Ä‘á»•i nÃ o â†’ AUTO vá» Pending
     * 2. STATUS CHANGE (quick action ngoÃ i list) â†’ KhÃ´ng edit content, chá»‰ Ä‘á»•i status
     * 
     * @param string $currentStatus Current content status
     * @param string $newStatus Desired new status
     * @param bool $isContentChanged Whether content fields were modified (for edit detection)
     */
    protected function canTransitionStatus(
        string $currentStatus, 
        string $newStatus, 
        bool $isContentChanged = false
    ): bool {
        $user = auth()->user();
        
        // Admin can do anything
        if ($user->role === 'admin') {
            return true;
        }
        
        // Moderator status transition rules
        if ($user->role === 'moderator') {
            // If content was changed (EDIT action), force to pending
            if ($isContentChanged && $currentStatus === 'published') {
                return $newStatus === 'pending'; // Must go to pending for re-approval
            }
            
            // Status-only transitions (quick actions, no content change)
            $allowedTransitions = [
                'draft' => ['pending'],                    // Submit for review
                'pending' => ['draft'],                    // Withdraw submission
                'published' => ['archived'],               // Take down (status button only)
                'archived' => ['draft'],                   // Restore to draft for re-editing
            ];
            
            return in_array($newStatus, $allowedTransitions[$currentStatus] ?? []);
        }
        
        return false;
    }
}
```

TODO 4.2: Cáº­p nháº­t ProductController
-------------------------------------
File: backend/app/Http/Controllers/Api/ProductController.php

Changes:

1. ThÃªm use Trait:
```php
use App\Http\Controllers\Traits\AuthorizesContent;

class ProductController extends Controller
{
    use AuthorizesContent;
```

2. Cáº­p nháº­t index() - Filter by ownership cho moderator:
```php
public function index(Request $request)
{
    try {
        $query = Product::query()->with(['tags', 'author', 'creator', 'updater']);
        
        $user = auth()->user();
        $isAdmin = $user && $user->role === 'admin';
        $isModerator = $user && $user->role === 'moderator';
        
        if ($isAdmin) {
            // Admin sees all
            if ($request->has('status') && $request->status !== 'all') {
                $query->where('status', $request->status);
            }
        } else if ($isModerator) {
            // Moderator only sees their own content
            $query->where('author_id', $user->id);
            
            // Filter by status if provided
            if ($request->has('status') && $request->status !== 'all') {
                $query->where('status', $request->status);
            }
        } else {
            // Public: only published
            $query->where('status', 'published');
        }
        
        // ... rest of filtering logic
    }
}
```

3. Cáº­p nháº­t store():
```php
public function store(Request $request)
{
    try {
        $data = $request->all();
        
        // ... existing data processing ...
        
        // Set default status based on role
        if (!isset($data['status']) || !$this->canSetStatus($data['status'])) {
            $data['status'] = $this->getDefaultStatus();
        }
        
        // Admin can set author_id, moderator cannot
        if (auth()->user()->role === 'admin') {
            // Admin can specify author_id from request
            if (!isset($data['author_id'])) {
                $data['author_id'] = auth()->id();
            }
            // Validate author exists
            $validated['author_id'] = 'nullable|exists:users,id';
        } else {
            // Moderator: force author to self
            $data['author_id'] = auth()->id();
        }
        
        // Validation rules - UPDATE status validation
        $validated = $request->validate([
            // ... existing rules ...
            'status' => 'nullable|in:draft,pending,published,archived',
            'author_id' => auth()->user()->role === 'admin' ? 'nullable|exists:users,id' : 'nullable',
        ]);
        
        // created_by and updated_by will be auto-set by Model boot()
        
        $product = Product::create($validated);
        
        // Load relationships for response
        $product->load(['tags', 'author', 'creator', 'updater']);
        
        // ... rest of logic
    }
}
```

4. Cáº­p nháº­t update():
```php
public function update(Request $request, $id)
{
    try {
        $product = Product::with(['tags', 'author', 'creator', 'updater'])->findOrFail($id);
        
        // Authorization check
        if (!$this->canModifyContent($product)) {
            return response()->json([
                'success' => false,
                'message' => 'Unauthorized. You can only modify your own content.'
            ], 403);
        }
        
        $data = $request->all();
        
        // Status validation
        if (isset($data['status']) && !$this->canSetStatus($data['status'])) {
            return response()->json([
                'success' => false,
                'message' => 'You are not authorized to set this status.'
            ], 403);
        }
        
        // Admin can change author_id, moderator cannot
        if (auth()->user()->role !== 'admin') {
            unset($data['author_id']); // Prevent moderator from changing author
        }
        
        // ... rest of validation and update logic
        
        $validated = $request->validate([
            // ... existing rules ...
            'status' => 'sometimes|required|in:draft,pending,published,archived',
            'author_id' => auth()->user()->role === 'admin' ? 'nullable|exists:users,id' : 'nullable',
        ]);
        
        $product->update($validated);
        
        // Reload relationships
        $product->load(['tags', 'author', 'creator', 'updater']);
        
        // ... rest of logic
    }
}
```

5. Cáº­p nháº­t destroy():
```php
public function destroy($id)
{
    try {
        $product = Product::findOrFail($id);
        
        // Authorization check
        if (!$this->canModifyContent($product)) {
            return response()->json([
                'success' => false,
                'message' => 'Unauthorized. You can only delete your own content.'
            ], 403);
        }
        
        $product->delete();
        
        // ... rest of logic
    }
}
```

TODO 4.3: Cáº­p nháº­t ArticleController
-------------------------------------
File: backend/app/Http/Controllers/Api/ArticleController.php

Apply SAME LOGIC nhÆ° ProductController:
- index(): Filter by author_id for moderator
- store(): Auto-set author_id, validate status
- update(): Check ownership, validate status
- destroy(): Check ownership

TODO 4.4: Cáº­p nháº­t VideoController
-----------------------------------
File: backend/app/Http/Controllers/Api/VideoController.php

Apply SAME LOGIC nhÆ° ProductController

âš ï¸ CRITICAL CHECK PHASE 4:
- TEST Admin create â†’ author_id cÃ³ thá»ƒ custom, status default published
- TEST Moderator create â†’ author_id = self, status default pending
- TEST Moderator edit own content â†’ success
- TEST Moderator edit other's content â†’ 403 error
- TEST Admin edit any content â†’ success
- TEST Moderator delete own â†’ success
- TEST Moderator delete other's â†’ 403
- TEST Status transitions: pending â†’ published (chá»‰ admin)
- TEST vá»›i cÃ¡c relationships: author, creator, updater cÃ³ load Ä‘Ãºng

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 5: FRONTEND TYPES & INTERFACES                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 5.1: Cáº­p nháº­t frontend types
----------------------------------
File: frontend/src/types/admin.ts

ThÃªm vÃ o ContentItem interface:
```typescript
export interface ContentItem {
  // ... existing fields ...
  author_id?: number;
  created_by?: number;
  updated_by?: number;
  author?: {
    id: number;
    name: string;
    email: string;
    avatar?: string;
  };
  creator?: {
    id: number;
    name: string;
  };
  updater?: {
    id: number;
    name: string;
  };
}
```

ThÃªm status enum:
```typescript
export type ContentStatus = 'draft' | 'pending' | 'published' | 'archived';
```

âš ï¸ CRITICAL CHECK PHASE 5:
- Verify types match backend response
- Verify optional fields (?) correctly placed

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 6: FRONTEND FORMS - ProductForm                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 6.1: Cáº­p nháº­t ProductForm component
-----------------------------------------
File: frontend/src/components/admin/ProductForm.tsx

Changes:

1. ThÃªm import useAuth:
```typescript
import { useAuth } from '../../contexts/AuthContext';
```

2. ThÃªm props Ä‘á»ƒ get list users (cho admin):
```typescript
interface ProductFormProps {
  // ... existing props ...
  users?: User[]; // For admin to select author
}
```

3. Trong component:
```typescript
const ProductForm: React.FC<ProductFormProps> = ({ 
  item, 
  onSave, 
  onCancel, 
  isDarkMode,
  users = []
}) => {
  const { user } = useAuth();
  const isAdmin = user?.role === 'admin';
  
  // ... existing state ...
```

4. ThÃªm field author_id vÃ o form (CHá»ˆ HIá»‚N THá»Š CHO ADMIN):
```typescript
{isAdmin && (
  <div>
    <TextField
      fullWidth
      select
      size="small"
      label="Author (Content Owner)"
      value={formData.author_id || user?.id}
      onChange={(e) => setFormData({ ...formData, author_id: Number(e.target.value) })}
      sx={textFieldStyles}
      helperText="Select the content author/owner"
    >
      {users.map(u => (
        <MenuItem key={u.id} value={u.id}>
          {u.name} ({u.email}) - {u.role}
        </MenuItem>
      ))}
    </TextField>
  </div>
)}
```

5. Cáº­p nháº­t Status dropdown - ADMIN ONLY:
```typescript
{/* ADMIN: Full status dropdown */}
{isAdmin && (
  <div>
    <label className="block text-sm font-medium mb-2">
      Status
    </label>
    <select
      id="status"
      value={formData.status || 'published'}
      onChange={(e) => setFormData({ 
        ...formData, 
        status: e.target.value as ContentStatus
      })}
      className={/* ... */}
    >
      <option value="draft">Draft</option>
      <option value="pending">Pending Review</option>
      <option value="published">Published</option>
      <option value="archived">Archived</option>
    </select>
  </div>
)}

{/* MODERATOR: No status dropdown in CREATE/EDIT form */}
{!isAdmin && (
  <Alert severity="info" sx={{ mb: 2 }}>
    {item ? (
      // EDIT mode
      <Typography variant="body2">
        âš ï¸ Saving changes will set status to <strong>Pending</strong> for admin review.
      </Typography>
    ) : (
      // CREATE mode
      <Typography variant="body2">
        Your content will be submitted as <strong>Pending</strong> for admin approval.
      </Typography>
    )}
  </Alert>
)}
```

Note: Moderator status = auto "pending" khi submit (khÃ´ng cÃ³ dropdown)

6. Hiá»ƒn thá»‹ thÃ´ng tin Created by / Last updated by (READ-ONLY):
```typescript
{item && (
  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
    <div>
      <Typography variant="caption" className="text-gray-500">
        Created by
      </Typography>
      <Typography variant="body2">
        {item.creator?.name || 'Unknown'} ({new Date(item.createdAt).toLocaleString()})
      </Typography>
    </div>
    <div>
      <Typography variant="caption" className="text-gray-500">
        Last updated by
      </Typography>
      <Typography variant="body2">
        {item.updater?.name || 'Unknown'} ({new Date(item.updatedAt).toLocaleString()})
      </Typography>
    </div>
  </div>
)}
```

âš ï¸ CRITICAL CHECK PHASE 6:
- TEST Admin: See author dropdown, can select any user
- TEST Moderator: NO author field (auto = self)
- TEST Form shows created_by and updated_by info when editing
- TEST Status dropdown has all 4 options
- TEST Submit with correct author_id

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 7: FRONTEND FORMS - ContentForm (Article/Video)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 7.1: Cáº­p nháº­t ContentForm component
-----------------------------------------
File: frontend/src/components/admin/ContentForm.tsx

Apply SAME CHANGES nhÆ° ProductForm:
- Add useAuth
- Add users prop
- Add author_id field (admin only)
- Update status dropdown (add pending)
- Show created_by / updated_by info

âš ï¸ CRITICAL CHECK PHASE 7:
- TÆ°Æ¡ng tá»± Phase 6

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 8: FRONTEND AdminDashboard - Integration                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 8.1: Fetch users list for admin
-------------------------------------
File: frontend/src/pages/AdminDashboard.tsx

ThÃªm state:
```typescript
const [allUsers, setAllUsers] = useState<User[]>([]);
```

ThÃªm vÃ o fetchData():
```typescript
const fetchData = async () => {
  try {
    // ... existing fetches ...
    
    // Fetch users if admin (for author selection)
    if (user?.role === 'admin') {
      const usersResponse = await userService.getAll();
      if (usersResponse.success) {
        setAllUsers(usersResponse.data);
      }
    }
  } catch (error) {
    // ...
  }
};
```

TODO 8.2: Pass users to forms
------------------------------
Khi render ProductForm:
```typescript
<ProductForm
  item={editingProduct}
  onSave={handleSaveProduct}
  onCancel={() => setActiveTab('products')}
  isDarkMode={isDarkMode}
  users={allUsers} // <-- ADD THIS
/>
```

Khi render ContentForm:
```typescript
<ContentForm
  // ... existing props
  users={allUsers} // <-- ADD THIS
/>
```

TODO 8.3: Cáº­p nháº­t filter/display logic
----------------------------------------
1. ThÃªm filter "My Content" cho moderator:
```typescript
{user?.role === 'moderator' && (
  <Chip 
    label="My Content Only" 
    color="primary" 
    size="small"
    sx={{ ml: 2 }}
  />
)}
```

2. Hiá»ƒn thá»‹ author name trong lists:
```typescript
// In product/content cards
<Typography variant="caption" color="text.secondary">
  By: {item.author?.name || 'Unknown'}
</Typography>
```

3. ThÃªm badge cho status "pending":
```typescript
{item.status === 'pending' && (
  <Chip 
    label="Pending Review" 
    color="warning" 
    size="small"
    icon={<AccessTime />}
  />
)}
```

âš ï¸ CRITICAL CHECK PHASE 8:
- TEST Admin: See all content, can filter by status
- TEST Moderator: See only own content
- TEST Content lists show author name
- TEST Pending items have warning badge
- TEST Forms receive users list correctly

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 9: FRONTEND STATUS BADGES & UI ENHANCEMENTS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 9.1: Táº¡o StatusBadge component cho content status
-------------------------------------------------------
File: frontend/src/components/ui/ContentStatusBadge.tsx

```typescript
import React from 'react';
import { Chip } from '@mui/material';
import { CheckCircle, Schedule, Archive, Edit } from '@mui/icons-material';

interface ContentStatusBadgeProps {
  status: 'draft' | 'pending' | 'published' | 'archived';
  size?: 'small' | 'medium';
}

const ContentStatusBadge: React.FC<ContentStatusBadgeProps> = ({ status, size = 'small' }) => {
  const configs = {
    draft: { 
      label: 'Draft', 
      color: 'default' as const, 
      icon: <Edit fontSize="small" /> 
    },
    pending: { 
      label: 'Pending Review', 
      color: 'warning' as const, 
      icon: <Schedule fontSize="small" /> 
    },
    published: { 
      label: 'Published', 
      color: 'success' as const, 
      icon: <CheckCircle fontSize="small" /> 
    },
    archived: { 
      label: 'Archived', 
      color: 'default' as const, 
      icon: <Archive fontSize="small" /> 
    }
  };
  
  const config = configs[status] || configs.draft;
  
  return (
    <Chip 
      label={config.label} 
      color={config.color}
      size={size}
      icon={config.icon}
      sx={{ fontWeight: 500 }}
    />
  );
};

export default ContentStatusBadge;
```

TODO 9.2: Sá»­ dá»¥ng StatusBadge trong lists
------------------------------------------
Trong ProductManagement, ContentManagementSection:
```typescript
import ContentStatusBadge from '../ui/ContentStatusBadge';

// In render:
<ContentStatusBadge status={item.status} />
```

âš ï¸ CRITICAL CHECK PHASE 9:
- TEST Badge colors: draft (gray), pending (orange), published (green), archived (gray)
- TEST Badge icons hiá»ƒn thá»‹ Ä‘Ãºng
- TEST Badge size responsive

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 10: QUICK STATUS BUTTONS (MODERATOR)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 10.1: ThÃªm Quick Status Action Buttons vÃ o Content/Product Lists
----------------------------------------------------------------------
File: frontend/src/components/admin/ProductManagement.tsx (vÃ  ContentManagementSection)

âš ï¸ QUAN TRá»ŒNG: Buttons nÃ y KHÃ”NG vÃ o form edit, chá»‰ update status trá»±c tiáº¿p

Implement logic theo status hiá»‡n táº¡i:

**1. DRAFT Content:**
```typescript
<ButtonGroup size="small" variant="outlined">
  <Tooltip title="Submit for admin review">
    <Button 
      startIcon={<Send />}
      onClick={() => handleQuickStatusChange(item.id, 'pending')}
      color="primary"
    >
      Submit
    </Button>
  </Tooltip>
  <Button startIcon={<Edit />} onClick={() => handleEdit(item)}>
    Edit
  </Button>
  <Button startIcon={<Delete />} onClick={() => handleDelete(item)} color="error">
    Delete
  </Button>
</ButtonGroup>
```

**2. PENDING Content:**
```typescript
<ButtonGroup size="small" variant="outlined">
  <Tooltip title="Withdraw submission">
    <Button 
      startIcon={<Undo />}
      onClick={() => handleQuickStatusChange(item.id, 'draft')}
      color="warning"
    >
      Withdraw
    </Button>
  </Tooltip>
  <Button startIcon={<Edit />} onClick={() => handleEdit(item)}>
    Edit
  </Button>
  <Button startIcon={<Delete />} onClick={() => handleDelete(item)} color="error">
    Delete
  </Button>
</ButtonGroup>
```

**3. PUBLISHED Content:**
```typescript
<ButtonGroup size="small" variant="outlined">
  <Tooltip title="Take down from public">
    <Button 
      startIcon={<Archive />}
      onClick={() => handleQuickStatusChange(item.id, 'archived')}
      color="warning"
    >
      Archive
    </Button>
  </Tooltip>
  <Button startIcon={<Edit />} onClick={() => handleEdit(item)}>
    Edit (Re-approval needed)
  </Button>
  <Button startIcon={<Delete />} onClick={() => handleDelete(item)} color="error">
    Delete
  </Button>
</ButtonGroup>
```

**4. ARCHIVED Content:**
```typescript
<ButtonGroup size="small" variant="outlined">
  <Tooltip title="Restore to draft for re-editing">
    <Button 
      startIcon={<RestoreFromTrash />}
      onClick={() => handleQuickStatusChange(item.id, 'draft')}
      color="info"
    >
      Restore
    </Button>
  </Tooltip>
  <Button startIcon={<Delete />} onClick={() => handleDelete(item)} color="error">
    Delete
  </Button>
</ButtonGroup>
```

TODO 10.2: Implement handleQuickStatusChange function
------------------------------------------------------
```typescript
const handleQuickStatusChange = async (id: string, newStatus: ContentStatus) => {
  try {
    // Confirm dialog
    const messages = {
      pending: 'Submit this content for admin review?',
      draft: 'Withdraw this content back to draft?',
      archived: 'Archive this content? It will be hidden from public.',
      published: 'This is not allowed via quick action.'
    };
    
    const confirmed = await showConfirmDialog(
      'Change Status',
      messages[newStatus]
    );
    
    if (!confirmed) return;
    
    // Update status only (no content change)
    const service = getServiceByType(item.type);
    await service.update(id, { 
      status: newStatus 
      // CRITICAL: Chá»‰ update status, KHÃ”NG update content fields
    });
    
    showToast(`Status changed to ${newStatus}`, 'success');
    await fetchItems(); // Reload list
  } catch (error) {
    showToast('Error changing status', 'error');
  }
};
```

TODO 10.3: Update Backend Controller Ä‘á»ƒ phÃ¢n biá»‡t Status-Only vs Edit
-----------------------------------------------------------------------
File: backend/app/Http/Controllers/Api/ProductController.php (vÃ  Article, Video)

```php
public function update(Request $request, $id)
{
    try {
        $product = Product::findOrFail($id);
        
        // Authorization
        if (!$this->canModifyContent($product)) {
            return response()->json([
                'success' => false,
                'message' => 'Unauthorized'
            ], 403);
        }
        
        $data = $request->all();
        $user = auth()->user();
        
        // Detect if this is a STATUS-ONLY change (quick action)
        $statusOnlyFields = ['status'];
        $providedFields = array_keys($data);
        $isStatusOnly = count($providedFields) === 1 && in_array('status', $providedFields);
        
        // Detect if content was actually changed
        $contentFields = ['name', 'title', 'description', 'content', 'image', 'price', /* ... all content fields */];
        $isContentChanged = false;
        foreach ($contentFields as $field) {
            if (isset($data[$field]) && $data[$field] != $product->$field) {
                $isContentChanged = true;
                break;
            }
        }
        
        // Moderator logic
        if ($user->role === 'moderator') {
            $currentStatus = $product->status;
            $newStatus = $data['status'] ?? $currentStatus;
            
            if ($isStatusOnly) {
                // Quick status change - use transition rules
                if (!$this->canTransitionStatus($currentStatus, $newStatus, false)) {
                    return response()->json([
                        'success' => false,
                        'message' => 'Invalid status transition'
                    ], 403);
                }
            } else {
                // Content edit - force to pending if currently published
                if ($isContentChanged && $currentStatus === 'published') {
                    $data['status'] = 'pending';
                    \Log::info('Moderator edited published content - forcing to pending', [
                        'product_id' => $id,
                        'user_id' => $user->id
                    ]);
                }
            }
        }
        
        // Validation and update
        $validated = $request->validate([
            // ... rules
        ]);
        
        $product->update($validated);
        $product->load(['tags', 'author', 'creator', 'updater']);
        
        return response()->json([
            'success' => true,
            'message' => 'Updated successfully',
            'data' => new ProductResource($product)
        ]);
    } catch (\Exception $e) {
        // Error handling
    }
}
```

âš ï¸ CRITICAL CHECK PHASE 10:
- TEST Moderator Draft â†’ Submit button â†’ Status = pending
- TEST Moderator Pending â†’ Withdraw button â†’ Status = draft
- TEST Moderator Published â†’ Archive button â†’ Status = archived (khÃ´ng vÃ o form)
- TEST Moderator Archived â†’ Restore button â†’ Status = draft
- TEST Moderator Edit Published content â†’ Save â†’ Auto status = pending
- TEST Quick status change KHÃ”NG trigger "Last updated by" náº¿u chá»‰ Ä‘á»•i status
- TEST Confirm dialogs hiá»ƒn thá»‹ Ä‘Ãºng message
- TEST Admin: CÃ³ Ä‘áº§y Ä‘á»§ buttons vÃ  khÃ´ng bá»‹ restrict

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 11: APPROVAL MANAGEMENT SYSTEM (ADMIN ONLY)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 11.1: ThÃªm "Approval Management" vÃ o AdminSidebar
-------------------------------------------------------
File: frontend/src/components/admin/AdminSidebar.tsx

ThÃªm navigation item (chá»‰ hiá»‡n cho admin):
```typescript
{
  id: 'approvals',
  label: 'Approval Management',
  icon: CheckCircle, // Import from lucide-react
  color: 'from-orange-500 to-amber-600',
  description: 'Review pending content',
  count: stats.pendingCount || 0, // Count sá»‘ pending items
  adminOnly: true, // Chá»‰ admin má»›i tháº¥y
}
```

TODO 11.2: Táº¡o component ApprovalManagement
--------------------------------------------
File: frontend/src/components/admin/ApprovalManagement.tsx

Component structure:
```typescript
interface ApprovalManagementProps {
  isDarkMode: boolean;
  onApprove: (id: string, type: string) => Promise<void>;
  onReject: (id: string, type: string, reason?: string) => Promise<void>;
}

Features:
1. Tabs: "All Pending" | "Products" | "Articles" | "Videos"
2. Card layout cho má»—i pending item:
   - Title, description, author name
   - Created date
   - Preview image
   - Tags
   - Action buttons: "Approve" (green) | "Reject" (red) | "Edit" (blue)
3. Filter: by author, by date range
4. Sort: newest first, oldest first
5. Bulk actions: Select multiple â†’ Approve all / Reject all
```

Example card:
```typescript
<Card className="p-4 mb-4">
  <div className="flex justify-between items-start">
    <div>
      <Typography variant="h6">{item.title}</Typography>
      <Typography variant="caption" color="text.secondary">
        By: {item.author?.name} | {formatDate(item.created_at)}
      </Typography>
      <Typography variant="body2" className="mt-2">
        {truncate(item.description, 150)}
      </Typography>
      <div className="mt-2">
        <ContentStatusBadge status="pending" />
        <Chip label={item.type} size="small" sx={{ ml: 1 }} />
      </div>
    </div>
    <div className="flex gap-2">
      <Button 
        color="success" 
        onClick={() => handleApprove(item)}
        startIcon={<CheckCircle />}
      >
        Approve
      </Button>
      <Button 
        color="error" 
        onClick={() => handleReject(item)}
        startIcon={<XCircle />}
      >
        Reject
      </Button>
      <IconButton onClick={() => handleEdit(item)}>
        <Edit />
      </IconButton>
    </div>
  </div>
</Card>
```

TODO 11.3: ThÃªm API endpoints cho Approval
-------------------------------------------
Backend: KHÃ”NG Cáº¦N endpoint má»›i - Sá»­ dá»¥ng update() endpoint hiá»‡n cÃ³
Frontend: Khi approve â†’ gá»i update API vá»›i status = 'published'

Approve logic:
```typescript
const handleApprove = async (item: ContentItem) => {
  try {
    const service = getServiceByType(item.type); // article/video/product service
    await service.update(item.id, { status: 'published' });
    showToast('Content approved and published!', 'success');
    await fetchPendingItems(); // Reload list
  } catch (error) {
    showToast('Error approving content', 'error');
  }
};
```

Reject logic:
```typescript
const handleReject = async (item: ContentItem) => {
  // Show dialog to enter rejection reason
  const reason = await showRejectDialog();
  if (!reason) return;
  
  try {
    const service = getServiceByType(item.type);
    // Change status to draft + add rejection note
    await service.update(item.id, { 
      status: 'draft',
      // TODO: CÃ³ thá»ƒ thÃªm field rejection_note vÃ o DB náº¿u muá»‘n
    });
    
    // Send notification to author (optional - future feature)
    // await notificationService.send(item.author_id, reason);
    
    showToast('Content rejected', 'warning');
    await fetchPendingItems();
  } catch (error) {
    showToast('Error rejecting content', 'error');
  }
};
```

TODO 11.4: Táº¡o RejectDialog component
--------------------------------------
File: frontend/src/components/admin/RejectDialog.tsx

```typescript
interface RejectDialogProps {
  open: boolean;
  onClose: () => void;
  onConfirm: (reason: string) => void;
  contentTitle: string;
}

// Dialog with textarea for rejection reason
```

TODO 11.5: Fetch pending items logic
-------------------------------------
File: frontend/src/pages/AdminDashboard.tsx

ThÃªm state:
```typescript
const [pendingItems, setPendingItems] = useState<ContentItem[]>([]);
const [pendingCount, setPendingCount] = useState(0);
```

ThÃªm fetch function:
```typescript
const fetchPendingItems = async () => {
  try {
    // Fetch all pending items from all types
    const [productsRes, articlesRes, videosRes] = await Promise.all([
      productService.getAll({ status: 'pending' }),
      articlesService.getAll({ status: 'pending' }),
      videosService.getAll({ status: 'pending' })
    ]);
    
    const allPending = [
      ...productsRes.data.map(p => ({ ...transformProductByCategory(p), type: 'product' })),
      ...articlesRes.data.map(a => ({ ...transformArticleToContentItem(a), type: 'article' })),
      ...videosRes.data.map(v => ({ ...transformVideoToContentItem(v), type: 'video' }))
    ];
    
    setPendingItems(allPending);
    setPendingCount(allPending.length);
  } catch (error) {
    console.error('Error fetching pending items:', error);
  }
};
```

TODO 11.6: ThÃªm notification badge cho Approval menu
-----------------------------------------------------
AdminSidebar: Show badge with pending count
```typescript
<Badge badgeContent={stats.pendingCount} color="warning">
  <CheckCircle />
</Badge>
```

TODO 11.7: Integration vÃ o AdminDashboard
------------------------------------------
ThÃªm case 'approvals' vÃ o switch:
```typescript
case 'approvals':
  return (
    <ApprovalManagement
      isDarkMode={isDarkMode}
      pendingItems={pendingItems}
      onApprove={handleApproveContent}
      onReject={handleRejectContent}
      onEdit={(item) => {
        if (item.type === 'article' || item.type === 'video') {
          setEditingItem(item);
          setActiveTab('content-edit');
        } else {
          setEditingProduct(item);
          setActiveTab('product-edit');
        }
      }}
    />
  );
```

âš ï¸ CRITICAL CHECK PHASE 11:
- TEST Admin: See "Approval Management" in sidebar
- TEST Moderator: KHÃ”NG tháº¥y menu nÃ y
- TEST Badge hiá»ƒn thá»‹ sá»‘ pending items Ä‘Ãºng
- TEST Approve button â†’ Content status = published
- TEST Reject button â†’ Show dialog â†’ Content status = draft
- TEST Edit button â†’ Navigate to edit form vá»›i data Ä‘Ãºng
- TEST Bulk approve: Select nhiá»u items â†’ Approve all
- TEST Filter by content type (product/article/video)
- TEST Real-time: Sau approve/reject â†’ List update ngay

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 12: END-TO-END TESTING & VERIFICATION                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODO 12.1: Test Scenario - Admin Workflow
------------------------------------------
1. Login as Admin
2. Create Product:
   âœ“ Author dropdown visible
   âœ“ Can select any user as author
   âœ“ Default status = published
   âœ“ Submit â†’ Check DB: author_id, created_by, updated_by set correctly
3. Edit Product:
   âœ“ Can change author
   âœ“ Can change status to any value
   âœ“ Submit â†’ Check DB: updated_by changed
4. View Product list:
   âœ“ See all products (any author)
   âœ“ See author name in cards
5. Delete any product:
   âœ“ Success

TODO 12.2: Test Scenario - Moderator Workflow
----------------------------------------------
1. Login as Moderator
2. Create Product:
   âœ“ NO author dropdown
   âœ“ Default status = pending
   âœ“ Submit â†’ Check DB: author_id = moderator's ID
3. Edit own Product:
   âœ“ Success
   âœ“ Can change status: draft â†” pending (NOT published/archived)
4. Try edit other's Product:
   âœ“ Should show 403 error or hide edit button
5. View Product list:
   âœ“ See ONLY own products
6. Try delete other's product:
   âœ“ Should show 403 or hide delete button

TODO 12.3: Test Scenario - User Deletion
-----------------------------------------
1. Create content with author_id = User X
2. Delete User X from system
3. Check content:
   âœ“ Content still exists
   âœ“ author_id = NULL (because onDelete: set null)
   âœ“ created_by, updated_by = NULL
4. Admin can reassign author:
   âœ“ Edit content â†’ Select new author â†’ Save

TODO 12.4: Test Scenario - Status Workflow
-------------------------------------------
1. Moderator creates content â†’ status = pending
2. Admin views content â†’ See "Pending Review" badge
3. Admin edits â†’ Change status to "published"
4. Public API: Verify content now visible
5. Admin changes to "archived"
6. Public API: Verify content NOT visible

TODO 12.5: Test Scenario - Display Created/Updated Info
--------------------------------------------------------
1. Create content (User A)
2. Edit form â†’ Verify shows:
   âœ“ Created by: User A (date)
   âœ“ Last updated by: User A (date)
3. Admin edits content
4. Edit form â†’ Verify shows:
   âœ“ Created by: User A (original date)
   âœ“ Last updated by: Admin (new date)

TODO 12.6: Cross-Content Type Testing
--------------------------------------
Repeat all tests for:
- âœ“ Products (all 5 categories: tool, book, pot, accessory, suggestion)
- âœ“ Articles
- âœ“ Videos

TODO 12.7: Test Scenario - Approval Management Workflow
--------------------------------------------------------
1. Moderator creates Product/Article/Video â†’ status = pending
2. Admin login â†’ Navigate to "Approval Management"
3. Verify:
   âœ“ See pending item in list
   âœ“ Badge shows count = 1
   âœ“ Item shows author name (moderator)
   âœ“ Item shows created date
4. Admin clicks "Approve":
   âœ“ Confirm dialog appears
   âœ“ Click confirm â†’ Item disappears from pending list
   âœ“ Badge count decreases
   âœ“ Check product list â†’ Status = published
5. Moderator creates another content
6. Admin clicks "Reject":
   âœ“ Reject dialog with textarea appears
   âœ“ Enter reason â†’ Submit
   âœ“ Item disappears from pending list
   âœ“ Check DB â†’ Status = draft
7. Admin clicks "Edit" on pending item:
   âœ“ Navigate to edit form
   âœ“ Can change author
   âœ“ Can approve by changing status to published
8. Bulk operations:
   âœ“ Select 3 pending items
   âœ“ Click "Approve All" â†’ All 3 approved
   âœ“ Badge count updates correctly

TODO 12.8: API Response Validation
-----------------------------------
Check API responses include:
```json
{
  "author_id": 123,
  "created_by": 123,
  "updated_by": 456,
  "author": {
    "id": 123,
    "name": "John Doe",
    "email": "john@example.com",
    "avatar": "..."
  },
  "creator": {
    "id": 123,
    "name": "John Doe"
  },
  "updater": {
    "id": 456,
    "name": "Admin User"
  },
  "status": "pending"
}
```

===================================================================================
ğŸ” VERIFICATION CHECKLIST (PHáº¢I CHECK Táº¤T Cáº¢):
===================================================================================

DATABASE:
â–¡ Migrations run successfully
â–¡ Foreign keys created with onDelete('set null')
â–¡ Indexes created for performance
â–¡ Status enums updated to include 'pending'

BACKEND MODELS:
â–¡ author_id, created_by, updated_by in fillable
â–¡ Relationships defined correctly
â–¡ boot() method auto-tracks created_by/updated_by

BACKEND RESOURCES:
â–¡ author, creator, updater in API response
â–¡ whenLoaded() used to prevent N+1

BACKEND CONTROLLERS:
â–¡ index() filters by author_id for moderator
â–¡ store() auto-sets author_id correctly
â–¡ store() respects default status by role
â–¡ update() checks ownership for moderator
â–¡ update() validates status change permissions
â–¡ destroy() checks ownership

FRONTEND TYPES:
â–¡ ContentItem includes author_id, created_by, updated_by, relationships

FRONTEND FORMS:
â–¡ Admin sees author dropdown
â–¡ Moderator doesn't see author dropdown
â–¡ Status dropdown has 4 options
â–¡ Created by / Updated by info displayed
â–¡ Users list passed as prop

FRONTEND DASHBOARD:
â–¡ Moderator sees only own content
â–¡ Admin sees all content
â–¡ Status badges display correctly
â–¡ Author name shown in lists

END-TO-END:
â–¡ All test scenarios passed
â–¡ No console errors
â–¡ No API errors (check Network tab)
â–¡ Database integrity maintained

===================================================================================
ğŸ“Œ NOTES & WARNINGS:
===================================================================================

1. **Migration Order**: Cháº¡y migrations theo thá»© tá»± Ä‘á»ƒ trÃ¡nh foreign key errors

2. **User Deletion**: onDelete('set null') quan trá»ng Ä‘á»ƒ content khÃ´ng bá»‹ cascade delete

3. **Authorization**: CRITICAL - Must check both role AND ownership

4. **Default Status**: 
   - Admin â†’ published (trust admin)
   - Moderator â†’ pending (needs approval)

5. **Status Transitions**:
   - Moderator: draft â†” pending
   - Admin: any â†’ any

6. **N+1 Query Prevention**: Always use ->with(['author', 'creator', 'updater']) when loading

7. **Frontend State**: Sau khi create/update, reload list Ä‘á»ƒ hiá»ƒn thá»‹ author info má»›i

8. **Security**: Moderator KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c:
   - Edit/delete content cá»§a ngÆ°á»i khÃ¡c
   - Set status = published/archived
   - Change author_id cá»§a content

===================================================================================
ğŸš€ EXECUTION PLAN:
===================================================================================

Step 1: Backend Foundations (Phases 1-4)
   â†’ Run migrations on server
   â†’ Update models, resources, controllers
   â†’ TEST all API endpoints with Postman/curl

Step 2: Frontend Integration (Phases 5-9)
   â†’ Update types
   â†’ Update forms
   â†’ Update dashboard
   â†’ TEST in browser

Step 3: Complete E2E Testing (Phase 10)
   â†’ Test all scenarios
   â†’ Fix any bugs
   â†’ Verify checklist

Step 4: Commit & Deploy
   â†’ git add frontend/ backend/
   â†’ git commit -m "feat: implement content authorship and moderator permissions"
   â†’ git push origin main

===================================================================================
END OF PROMPT
===================================================================================

